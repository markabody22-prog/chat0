<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Butterfly Garden Mobile</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        :root { --main-bg: #f0f2f5; --primary: #7fb069; --accent: #9575cd; --me-bg: #dcf8c6; }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--main-bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Header */
        header { background: var(--primary); color: white; padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 100; }
        .brand { font-weight: bold; font-size: 1.1rem; }

        /* Chat Area */
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; background: #e5ddd5; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); }
        
        .bubble { max-width: 85%; padding: 8px 12px; border-radius: 12px; position: relative; font-size: 15px; line-height: 1.4; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
        .mine { align-self: flex-start; background: white; border-top-left-radius: 0; }
        .others { align-self: flex-end; background: var(--me-bg); border-top-right-radius: 0; }
        
        .sender { display: block; font-size: 11px; font-weight: bold; color: var(--accent); margin-bottom: 2px; }
        .time { font-size: 10px; color: #888; text-align: left; margin-top: 4px; display: block; }
        .del { color: #ff5252; font-size: 14px; background: none; border: none; padding: 0; margin-right: 8px; cursor: pointer; }

        /* Input Bar - Mobile Optimized */
        .input-bar { background: #f0f0f0; padding: 8px 12px; display: flex; align-items: flex-end; gap: 8px; border-top: 1px solid #ddd; }
        .input-wrapper { flex: 1; background: white; border-radius: 20px; padding: 5px 12px; display: flex; align-items: center; border: 1px solid #ccc; }
        textarea { flex: 1; border: none; outline: none; padding: 8px 0; max-height: 100px; resize: none; font-size: 16px; font-family: inherit; }
        
        .icon-btn { background: none; border: none; font-size: 22px; cursor: pointer; padding: 5px; color: #666; }
        #sendBtn { background: var(--primary); color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Emoji Panel */
        #emoji-panel { display: none; background: white; grid-template-columns: repeat(8, 1fr); padding: 10px; border-top: 1px solid #ddd; max-height: 200px; overflow-y: auto; }
        .emoji { font-size: 24px; padding: 5px; cursor: pointer; text-align: center; }
    </style>
</head>
<body>

    <header>
        <span class="brand">ü¶ã Butterfly Chat</span>
        <button class="icon-btn" style="color:white" onclick="clearChat()">üóëÔ∏è</button>
    </header>

    <div id="chat-window"></div>

    <div id="emoji-panel"></div>

    <div class="input-bar">
        <button class="icon-btn" onclick="toggleEmoji()">üòä</button>
        <div class="input-wrapper">
            <textarea id="msgInput" rows="1" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ©..." oninput="autoHeight(this)"></textarea>
        </div>
        <button id="sendBtn" onclick="send()">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="white"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
        </button>
    </div>

<script>
    const API_KEY = 'XGo5cg.HJoQoA:tgdISgIHM4HJKMf3-H1Zh4dpouEoCR-zyunHiWVlq7E'; 
    const ably = new Ably.Realtime(API_KEY);
    const channel = ably.channels.get('butterfly-v4-mobile');
    
    const input = document.getElementById('msgInput');
    const windowChat = document.getElementById('chat-window');
    const myId = "u_" + Math.random().toString(36).substr(2, 4);
    const myName = "ŸÑÿßÿπÿ®_" + Math.floor(100 + Math.random() * 900);

    // Emoji List
    const emojis = ["üòä","üòÇ","‚ù§Ô∏è","üòç","ü§£","üëç","üôè","üî•","‚ú®","ü¶ã","üå∏","üéÆ","üÉè","üåô","‚≠ê","üíî","üò¢","üòé"];
    const panel = document.getElementById('emoji-panel');
    emojis.forEach(e => {
        let span = document.createElement('span');
        span.className = 'emoji';
        span.innerText = e;
        span.onclick = () => { input.value += e; input.focus(); };
        panel.appendChild(span);
    });

    function toggleEmoji() { panel.style.display = panel.style.display === 'grid' ? 'none' : 'grid'; }
    function autoHeight(el) { el.style.height = "auto"; el.style.height = (el.scrollHeight) + "px"; }

    function send() {
        const txt = input.value.trim();
        if(!txt) return;
        const id = "m_" + Date.now();
        channel.publish('msg', { id, sender: myId, user: myName, text: txt, type: 'new' });
        input.value = '';
        input.style.height = "auto";
        panel.style.display = 'none';
    }

    channel.subscribe('msg', (m) => {
        const d = m.data;
        if(d.type === 'del') { document.getElementById(d.id)?.remove(); return; }

        const isMe = d.sender === myId;
        const div = document.createElement('div');
        div.id = d.id;
        div.className = `bubble ${isMe ? 'mine' : 'others'}`;
        div.innerHTML = `
            <span class="sender">${d.user}</span>
            ${d.text}
            <span class="time">${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})} 
            ${isMe ? `<button class="del" onclick="deleteMsg('${d.id}')">üóëÔ∏è</button>` : ''}</span>
        `;
        windowChat.appendChild(div);
        windowChat.scrollTop = windowChat.scrollHeight;
    });

    function deleteMsg(id) { channel.publish('msg', { id, type: 'del' }); }
    function clearChat() { if(confirm("ŸáŸÑ ÿ™ÿ±ŸäÿØ ŸÖÿ≥ÿ≠ ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÑÿØŸäŸÉÿü")) windowChat.innerHTML = ''; }
    input.onkeydown = (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); } };
</script>
</body>
</html>
